# ===============================
# KD-Student (Video-aware, final)
# ===============================

# --- 基础 ---
experiment_regime: "KD-Student-VideoAware"
experiment_notes: "Video-aware split; T=5.0, alpha=0.5; KD training, 30 epochs"
epochs: 30
batch_size: 6
img_size: 384
num_classes: 3
num_workers: 4

# --- 分类配置 ---
classification_scheme: "3class_org"

# --- 优化与调度 ---
optimizer: "adamw"
lr: 0.0005
weight_decay: 0.001
scheduler: "cosine"

# --- 数据/划分（Video-aware）---
split_strategy: "video_aware"          # ✅ 支持
val_ratio: 0.2                         # video_aware需要

# --- FOV/预处理 ---
apply_fov_mask: true

# --- 增强 ---
augment: true
flip_prob: 0.5
rotation_degree: 15

# --- 知识蒸馏（平级参数）---
enable_distillation: true
teacher_model: "unet_plus_plus"
teacher_checkpoint: "outputs/unet_plus_plus_20250911_230321/checkpoints/unet_plus_plus_best.pth"
student_model: "adaptive_unet"

# 蒸馏参数（使用系统支持的格式）
distill_temperature: 5.0              # temperature
distill_alpha: 0.5                    # KD权重 (降低以防压过CE+Dice)
distill_beta: 0.5                     # Task权重  
distill_feature_weight: 0.1           # 特征蒸馏权重

# --- 监控/保存/早停 ---
save_best_only: true
val_interval: 1
save_interval: 5
early_stopping: true
patience: 10
loss_threshold: 0.015                  # Loss改善阈值（hybrid evaluation）
loss_degradation_threshold: 0.05       # Loss恶化阈值

# --- 高级损失函数配置 ---
loss_type: "combined"                  # ce, focal, dice, combined, label_smoothing
dice_weight: 0.4                       # Dice权重 (0.0=纯CE, 0.5=平衡, 1.0=纯Dice)
use_focal_loss: false                  # 是否在combined中使用Focal作为基础损失
focal_alpha: 1.0                       # Focal Loss alpha参数
focal_gamma: 2.0                       # Focal Loss gamma参数  
label_smoothing: 0.05                  # 标签平滑 (配合KD校准效果更好)
auto_class_weights: true               # 自动计算类别权重
class_weight_sample_ratio: 0.15        # 权重计算采样比例 (15%数据集)

# --- 早停策略配置 ---
early_stopping_metric: "miou"          # 早停判定指标: loss(最小化) 或 miou(最大化)

# --- 可视化/证据包 ---
save_viz: true
viz_samples: 12
generate_evidence_package: true
evidence_experiment_name: "KD_Student_VideoAware"